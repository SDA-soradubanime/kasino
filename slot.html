<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Machine Simulator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .container {
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 800px;
            width: 100%;
            position: relative;
            margin-top: 20px;
            z-index: 10;
        }

        .back-button {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: rgba(248, 211, 71, 0.2);
            color: #f8d347;
            border: 1px solid #f8d347;
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 100;
        }

        .back-button:hover {
            background-color: rgba(248, 211, 71, 0.4);
            transform: translateX(-3px);
        }

        .back-button::before {
            content: "‚Üê";
        }

        h1 {
            color: #f8d347;
            text-shadow: 0 0 10px rgba(248, 211, 71, 0.5);
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #ccc;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .slot-machine {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background-color: rgba(51, 51, 51, 0.7);
            padding: 15px;
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 100px;
            position: relative;
            z-index: 20;
        }

        .reel {
            width: 70px;
            height: 70px;
            background-color: white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            color: black;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .symbol {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-panel {
            background-color: rgba(51, 51, 51, 0.7);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            z-index: 20;
        }

        .balance {
            font-size: 22px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .balance-amount {
            font-weight: bold;
            color: #f8d347;
        }

        .settings {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .setting-group label {
            margin-bottom: 5px;
            font-size: 14px;
            color: #ddd;
        }

        .setting-group select, .setting-group input {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            background-color: #444;
            color: white;
            text-align: center;
        }

        .controls {
            margin: 20px 0;
            position: relative;
            z-index: 20;
        }

        .spin-button {
            background-color: #f8d347;
            color: #333;
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #d4b53c;
            position: relative;
            z-index: 20;
        }

        .spin-button:hover {
            background-color: #ffea00;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #d4b53c;
        }

        .spin-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #d4b53c;
        }

        .spin-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 0 #aaaaaa;
        }

        .win-message {
            color: #4caf50;
            font-size: 20px;
            font-weight: bold;
            height: 30px;
            margin: 10px 0;
            text-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
            position: relative;
            z-index: 20;
        }

        .info {
            margin-top: 20px;
            font-size: 12px;
            color: #999;
            line-height: 1.4;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        .winning-reel {
            animation: pulse 0.5s infinite alternate, glow 0.5s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.9); }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 1;
        }

        .explosion {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
        }

        .coin {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: gold;
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            animation: coin-fall linear;
        }

        @keyframes coin-fall {
            to {
                transform: translateY(100vh);
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
            }

            .reel {
                width: 50px;
                height: 50px;
                font-size: 25px;
            }

            .settings {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-button" onclick="window.location.href='index.html'">–ú–µ–Ω—é</button>

        <h1>üé∞ –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞</h1>
        <p class="subtitle">–ò–≥—Ä–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Å–ª–æ—Ç—ã!</p>

        <div class="game-panel">
            <div class="balance">
                –ë–∞–ª–∞–Ω—Å: <span id="balance" class="balance-amount">1000</span> –∫—Ä–µ–¥–∏—Ç–æ–≤
            </div>

            <div class="settings">
                <div class="setting-group">
                    <label for="reelCount">–ë–∞—Ä–∞–±–∞–Ω—ã:</label>
                    <select id="reelCount" onchange="changeReelCount()">
                        <option value="3">3</option>
                        <option value="5">5</option>
                        <option value="7">7</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label for="betAmount">–°—Ç–∞–≤–∫–∞:</label>
                    <input type="number" id="betAmount" min="1" max="1000" value="10">
                </div>
            </div>

            <div class="win-message" id="winMessage"></div>
        </div>

        <div class="slot-machine" id="slotMachine">
            <!-- –ë–∞—Ä–∞–±–∞–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <div class="controls">
            <button id="spinButton" class="spin-button">–ö—Ä—É—Ç–∏—Ç—å (10 –∫—Ä–µ–¥–∏—Ç–æ–≤)</button>
        </div>

        <div class="info">
            <p>–ø—Ä–æ–µ–∫—Ç—ã –Ø–ñ –¥–µ–ª–∞–ª–∏</p>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        const symbols = ['üçí', 'üçã', 'üçä', 'üçá', 'üçâ', '7Ô∏è‚É£', 'üîî', '‚≠ê'];
        const symbolWeights = [15, 15, 15, 12, 12, 8, 10, 13]; // –í–µ—Å–∞ –¥–ª—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
        let reels = [];
        let spinButton = document.getElementById('spinButton');
        let balanceDisplay = document.getElementById('balance');
        let winMessage = document.getElementById('winMessage');
        let slotMachine = document.getElementById('slotMachine');
        let betAmountInput = document.getElementById('betAmount');

        // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏–∑ localStorage
        let balance = localStorage.getItem('casinoBalance') ? parseInt(localStorage.getItem('casinoBalance')) : 1000;
        balanceDisplay.textContent = balance;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
        let reelCount = 3;
        let betAmount = 10;
        let isSpinning = false;

        // –í–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π —Å–∏–º–≤–æ–ª
        function getWeightedRandomSymbol() {
            const totalWeight = symbolWeights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;

            for (let i = 0; i < symbols.length; i++) {
                if (random < symbolWeights[i]) {
                    return symbols[i];
                }
                random -= symbolWeights[i];
            }

            return symbols[0];
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –±–∞—Ä–∞–±–∞–Ω–æ–≤
        function createReels() {
            slotMachine.innerHTML = '';
            reels = [];

            for (let i = 0; i < reelCount; i++) {
                const reel = document.createElement('div');
                reel.className = 'reel';
                reel.id = `reel${i+1}`;
                reel.innerHTML = '<div class="symbol">' + getWeightedRandomSymbol() + '</div>';
                slotMachine.appendChild(reel);
                reels.push(reel);
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞—Ä–∞–±–∞–Ω–æ–≤
        function changeReelCount() {
            reelCount = parseInt(document.getElementById('reelCount').value);
            createReels();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
        betAmountInput.addEventListener('change', function() {
            betAmount = parseInt(this.value);
            if (isNaN(betAmount) || betAmount < 1) {
                betAmount = 1;
                this.value = 1;
            } else if (betAmount > 100000000000000000000000000000000000000000000000000000000) {
                betAmount = 100000000000000000000000000000000000000000000000000000000;
                this.value = 100000000000000000000000000000000000000000000000000000000;
            }
            spinButton.textContent = `–ö—Ä—É—Ç–∏—Ç—å (${betAmount} –∫—Ä–µ–¥–∏—Ç–æ–≤)`;
        });

        // –í—Ä–∞—â–µ–Ω–∏–µ –±–∞—Ä–∞–±–∞–Ω–∞
        function spinReel(reel, duration, callback) {
            const startTime = Date.now();
            const endTime = startTime + duration;

            function update() {
                const currentTime = Date.now();
                const progress = (currentTime - startTime) / duration;

                if (currentTime < endTime) {
                    reel.children[0].textContent = getWeightedRandomSymbol();
                    requestAnimationFrame(update);
                } else {
                    reel.children[0].textContent = callback();
                }
            }

            update();
        }

        // –†–∞—Å—á–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∞ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —à–∞–Ω—Å—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤ –±–∞—Ä–∞–±–∞–Ω–æ–≤)
        function calculateWin(results) {
            // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å–∏–º–≤–æ–ª–∞–º
            const symbolCounts = {};
            results.forEach(symbol => {
                symbolCounts[symbol] = (symbolCounts[symbol] || 0) + 1;
            });

            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            const maxCount = Math.max(...Object.values(symbolCounts));

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –≤—ã–∏–≥—Ä—ã—à–∞ (50-60% –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞—Ä–∞–±–∞–Ω–æ–≤)
            const minWinCount = Math.ceil(reelCount * 0.5); // 50% –æ–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö

            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            if (maxCount >= minWinCount) {
                const winningSymbol = Object.keys(symbolCounts).find(
                    key => symbolCounts[key] === maxCount
                );

                let basePayout = 0;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—É—é –≤—ã–ø–ª–∞—Ç—É –¥–ª—è —Å–∏–º–≤–æ–ª–∞
                switch(winningSymbol) {
                    case '7Ô∏è‚É£': basePayout = 30; break;
                    case '‚≠ê': basePayout = 20; break;
                    case 'üîî': basePayout = 15; break;
                    default: basePayout = 10; break;
                }

                // –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –≤—ã—à–µ –º–Ω–æ–∂–∏—Ç–µ–ª—å)
                const countMultiplier = maxCount / reelCount * 2;

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –≤—ã–∏–≥—Ä—ã—à
                const winAmount = Math.round(
                    betAmount * basePayout * countMultiplier
                );

                return { amount: winAmount, symbol: winningSymbol, count: maxCount };
            }

            return { amount: 0 };
        }

        // –≠—Ñ—Ñ–µ–∫—Ç –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
        function createConfetti() {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];

            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = -10 + 'px';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
                document.body.appendChild(confetti);

                const animationDuration = Math.random() * 3 + 2;

                confetti.animate([
                    { top: '-10px', opacity: 1, transform: `rotate(0deg) translateX(${Math.random() * 20 - 10}px)` },
                    { top: '100vh', opacity: 0.5, transform: `rotate(${Math.random() * 360}deg) translateX(${Math.random() * 100 - 50}px)` }
                ], {
                    duration: animationDuration * 1000,
                    easing: 'cubic-bezier(0.1, 0.8, 0.9, 1)',
                    fill: 'forwards'
                });

                setTimeout(() => confetti.remove(), animationDuration * 1000);
            }
        }

        // –≠—Ñ—Ñ–µ–∫—Ç –≤–∑—Ä—ã–≤–∞
        function createExplosion(x, y, symbol) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = x + 'px';
            explosion.style.top = y + 'px';
            explosion.style.backgroundColor = getRandomColor();
            document.body.appendChild(explosion);

            const size = Math.random() * 50 + 50;

            explosion.animate([
                { transform: 'scale(0)', opacity: 1 },
                { transform: `scale(${size})`, opacity: 0 }
            ], {
                duration: 1000,
                easing: 'ease-out',
                fill: 'forwards'
            });

            setTimeout(() => explosion.remove(), 1000);

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ —Ü–µ–Ω—Ç—Ä –≤–∑—Ä—ã–≤–∞
            if (symbol) {
                const symbolElement = document.createElement('div');
                symbolElement.textContent = symbol;
                symbolElement.style.position = 'absolute';
                symbolElement.style.left = x + 'px';
                symbolElement.style.top = y + 'px';
                symbolElement.style.fontSize = '30px';
                symbolElement.style.transform = 'translate(-50%, -50%)';
                symbolElement.style.zIndex = '10';
                document.body.appendChild(symbolElement);

                symbolElement.animate([
                    { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
                    { transform: 'translate(-50%, -50%) scale(3)', opacity: 0 }
                ], {
                    duration: 1000,
                    easing: 'ease-out',
                    fill: 'forwards'
                });

                setTimeout(() => symbolElement.remove(), 1000);
            }
        }

        function getRandomColor() {
            const colors = ['#ff0000', '#ffff00', '#ff00ff', '#00ffff', '#ffffff'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // –≠—Ñ—Ñ–µ–∫—Ç –ø–∞–¥–∞—é—â–∏—Ö –º–æ–Ω–µ—Ç
        function createCoins() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const coin = document.createElement('div');
                    coin.className = 'coin';
                    coin.style.left = Math.random() * 100 + 'vw';
                    coin.style.top = -20 + 'px';
                    coin.style.width = Math.random() * 20 + 10 + 'px';
                    coin.style.height = coin.style.width;
                    document.body.appendChild(coin);

                    const duration = Math.random() * 2 + 1;
                    coin.style.animationDuration = duration + 's';

                    setTimeout(() => coin.remove(), duration * 1000);
                }, i * 100);
            }
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–∏–≥—Ä–∞–≤—à–∏—Ö –±–∞—Ä–∞–±–∞–Ω–æ–≤
        function highlightWinningReels(winningSymbol, results) {
            reels.forEach((reel, index) => {
                if (results[index] === winningSymbol) {
                    reel.classList.add('winning-reel');
                    setTimeout(() => {
                        reel.classList.remove('winning-reel');
                    }, 3000);
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ä–∞—â–µ–Ω–∏—è
        spinButton.addEventListener('click', function() {
            if (isSpinning || balance < betAmount) return;

            isSpinning = true;
            balance -= betAmount;
            balanceDisplay.textContent = balance;
            localStorage.setItem('casinoBalance', balance.toString());
            winMessage.textContent = '';
            spinButton.disabled = true;

            const results = [];
            let completedSpins = 0;

            // –í—Ä–∞—â–∞–µ–º –≤—Å–µ –±–∞—Ä–∞–±–∞–Ω—ã
            reels.forEach((reel, index) => {
                spinReel(reel, 800 + index * 200, () => {
                    const symbol = getWeightedRandomSymbol();
                    results[index] = symbol;
                    completedSpins++;

                    // –ö–æ–≥–¥–∞ –≤—Å–µ –±–∞—Ä–∞–±–∞–Ω—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å
                    if (completedSpins === reels.length) {
                        setTimeout(() => {
                            const winResult = calculateWin(results);
                            if (winResult.amount > 0) {
                                balance += winResult.amount;
                                balanceDisplay.textContent = balance;
                                localStorage.setItem('casinoBalance', balance.toString());

                                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–∞
                                winMessage.style.transform = 'scale(1.2)';
                                winMessage.textContent = `–í—ã–∏–≥—Ä—ã—à: ${winResult.amount} –∫—Ä–µ–¥–∏—Ç–æ–≤!`;
                                setTimeout(() => {
                                    winMessage.style.transform = 'scale(1)';
                                }, 300);

                                // –≠—Ñ—Ñ–µ–∫—Ç—ã –ø–æ–±–µ–¥—ã
                                createConfetti();
                                createCoins();
                                highlightWinningReels(winResult.symbol, results);

                                // –í–∑—Ä—ã–≤—ã –Ω–∞ –≤—ã–∏–≥—Ä–∞–≤—à–∏—Ö —Å–∏–º–≤–æ–ª–∞—Ö
                                reels.forEach((reel, i) => {
                                    if (results[i] === winResult.symbol) {
                                        const rect = reel.getBoundingClientRect();
                                        const x = rect.left + rect.width / 2;
                                        const y = rect.top + rect.height / 2;

                                        // –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∑—Ä—ã–≤–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
                                        for (let j = 0; j < 3; j++) {
                                            setTimeout(() => {
                                                createExplosion(
                                                    x + Math.random() * 40 - 20,
                                                    y + Math.random() * 40 - 20,
                                                    winResult.symbol
                                                );
                                            }, j * 300);
                                        }
                                    }
                                });
                            }

                            isSpinning = false;
                            spinButton.disabled = false;
                        }, 500);
                    }

                    return symbol;
                });
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        createReels();
        spinButton.textContent = `–ö—Ä—É—Ç–∏—Ç—å (${betAmount} –∫—Ä–µ–¥–∏—Ç–æ–≤)`;
    </script>
</body>
</html>
